Illumio Coding Assignment
Overview
This project is a Java-based solution to parse AWS VPC flow logs and map each log entry to a tag based on a lookup table. The program generates two output files:

tag_counts.csv: Count of matches for each tag.

port_protocol_counts.csv: Count of matches for each port/protocol combination.

The solution is designed to handle large flow log files (up to 10 MB) and lookup tables with up to 10,000 mappings. It adheres to the requirements provided by Illumio, including support for the default log format (version 2) and case-insensitive matching.

Table of Contents
Assumptions

Algorithm

Input and Output

Test Cases

How to Compile and Run

Performance Analysis

Generating Test Data

Conclusion

Assumptions
Flow Log Format:

The program only supports the default log format (version 2) as specified by AWS VPC Flow Logs.

The 7th field is assumed to be the destination port (dstport).

The 8th field is assumed to be the protocol.

Reference: AWS VPC Flow Logs Documentation.

Lookup Table:

The lookup table is a CSV file with three columns: dstport, protocol, and tag.

Multiple tags can map to the same dstport,protocol combination.

Output Files:

The tag_counts.csv file is sorted alphabetically by tag.

The port_protocol_counts.csv file is sorted numerically by port.

Case Insensitivity:

The program performs case-insensitive matching for dstport and protocol.

Untagged Logs:

Log entries that do not match any entry in the lookup table are counted under the Untagged tag.

Algorithm
The program follows these steps:

Load Lookup Table:

The LookupTable class reads the lookup table from a CSV file and stores it in a Map<String, List<String>>. The key is a combination of dstport,protocol, and the value is a list of tags.

Parse Flow Logs:

The FlowLogParser class reads the flow log file line by line.

For each log entry, it extracts the dstport and protocol fields.

It queries the lookup table to get the corresponding tags and updates the counts in tagCounts and portProtocolCounts.

Generate Outputs:

The tag_counts.csv file is generated by sorting the tagCounts map alphabetically.

The port_protocol_counts.csv file is generated by sorting the portProtocolCounts map numerically by port.

Efficiency:

The program uses HashMap for O(1) lookups in the lookup table.

Sorting the outputs is done in O(n log n) time, where n is the number of unique tags or port/protocol combinations.

Input and Output
Input Files
flow_logs.txt:

Contains flow log entries in the default AWS VPC Flow Logs format (version 2).

Example:

Copy
2 123456789012 eni-0a1b2c3d 10.0.1.201 198.51.100.2 49153 443 6 25 20000 1620140761 1620140821 ACCEPT OK
lookup_table.csv:

Contains mappings of dstport,protocol to tags.

Example:

Copy
dstport,protocol,tag
443,tcp,sv_P2
23,tcp,sv_P1
Output Files
tag_counts.csv:

Contains the count of matches for each tag, sorted alphabetically.

Example:

Copy
Tag,Count
sv_P1,1
sv_P2,1
Untagged,0
port_protocol_counts.csv:

Contains the count of matches for each port/protocol combination, sorted numerically by port.

Example:

Copy
Port,Protocol,Count
23,tcp,1
443,tcp,1
Test Cases
The project includes 20 test cases to ensure the program works correctly under various conditions. Each test case has:

A flow_logs.txt file.

A lookup_table.csv file.

An expected_output/ directory containing the expected tag_counts.csv and port_protocol_counts.csv.

Detailed Test Cases
Basic Test:

Tests basic functionality with a small flow log and lookup table.

Verifies that the program correctly maps tags and counts port/protocol combinations.

Multiple Tags for Same Port/Protocol:

Tests handling of multiple tags for the same dstport,protocol combination.

Ensures that all tags are counted correctly.

Untagged Logs:

Tests counting of logs that do not match any entry in the lookup table.

Ensures that untagged logs are counted under the Untagged tag.

Large File:

Simulates a 10 MB flow log file to test performance.

Ensures the program can handle large input files efficiently.

Case Insensitivity:

Tests case-insensitive matching for dstport and protocol.

Ensures that the program works correctly regardless of case.

Mixed Protocols:

Tests handling of logs with different protocols (e.g., TCP, UDP, ICMP).

Ensures that the program correctly identifies and counts each protocol.

Invalid Log Entries:

Tests handling of invalid log entries (e.g., malformed lines).

Ensures that the program skips invalid entries without crashing.

Large Lookup Table:

Simulates a lookup table with 10,000 mappings.

Ensures the program can handle large lookup tables efficiently.

ICMP Protocol:

Tests handling of ICMP protocol logs.

Ensures that the program correctly identifies and counts ICMP traffic.

Zero Port:

Tests handling of logs with a destination port of 0.

Ensures that the program correctly processes such logs.

UDP Protocol:

Tests handling of UDP protocol logs.

Ensures that the program correctly identifies and counts UDP traffic.

Unknown Protocol:

Tests handling of logs with an unknown protocol.

Ensures that the program correctly identifies and counts such logs.

Multiple Logs with Same Port/Protocol:

Tests handling of multiple logs with the same dstport,protocol combination.

Ensures that the program correctly aggregates counts.

Mixed Tags for Same Port/Protocol:

Tests handling of multiple tags for the same dstport,protocol combination.

Ensures that all tags are counted correctly.

Large Number of Tags:

Simulates a lookup table with a large number of unique tags.

Ensures that the program can handle a large number of tags efficiently.

Empty Flow Logs:

Tests handling of an empty flow log file.

Ensures that the program generates empty output files.

Empty Lookup Table:

Tests handling of an empty lookup table.

Ensures that all logs are counted as Untagged.

Duplicate Tags:

Tests handling of duplicate tags in the lookup table.

Ensures that the program correctly counts duplicate tags.

Special Characters in Tags:

Tests handling of tags with special characters.

Ensures that the program correctly processes such tags.

Large Port Numbers:

Tests handling of logs with large port numbers (e.g., 65535).

Ensures that the program correctly processes such logs.

How to Compile and Run
Compile the Code
Navigate to the project directory:

bash
Copy
cd illumio-assessment
Compile the Java code:

bash
Copy
javac src/com/illumio/*.java -d out/
Run the Program
Run the program with input and output directories:

bash
Copy
java -cp out com.illumio.Main input output
Run Test Cases
Make the test script executable:

bash
Copy
chmod +x run_tests.sh
Run the test script:

bash
Copy
./run_tests.sh
Performance Analysis
Time Complexity:

Loading the lookup table: O(n), where n is the number of mappings.

Parsing flow logs: O(m), where m is the number of log entries.

Sorting outputs: O(k log k), where k is the number of unique tags or port/protocol combinations.

Space Complexity:

O(n + m) for storing the lookup table and flow log data.

Generating Test Data
To generate large flow logs and lookup tables for testing, Python scripts are provided:

generate_flow_logs.py:

Generates a 10 MB flow log file with random entries.

generate_lookup_table.py:

Generates a lookup table with 10,000 mappings.

Run the scripts as follows:

bash
Copy
python generate_flow_logs.py
python generate_lookup_table.py
Conclusion
This project demonstrates a robust and efficient solution for parsing AWS VPC flow logs and mapping them to tags. It adheres to the requirements, handles edge cases, and is optimized for performance. The inclusion of 20 test cases ensures the program works correctly under various conditions. The code is well-structured, easy to understand, and can be run on any local machine without additional dependencies.
